# Test lut2mux pass using a directly constructed $lut (avoids frontend/synth differences in test-verific)

read_rtlil <<'EOT'
module \top
  wire input 2 \a
  wire output 1 \y
  cell $lut \u_lut
    parameter \WIDTH 2
    parameter \LUT 4'0110
    connect \A \a
    connect \Y \y
  end
end
EOT

select -assert-count 1 t:$lut

# default mode -> gate-level $_MUX_
design -save gold
lut2mux
select -assert-count 3 t:$_MUX_
select -assert-count 0 t:$mux
select -assert-count 0 t:$lut
design -stash gate

# -word mode -> word-level $mux
design -load gold
lut2mux -word
select -assert-count 3 t:$mux
select -assert-count 0 t:$_MUX_
select -assert-count 0 t:$lut
design -stash word

# equivalence
design -copy-from gate -as gate top
design -copy-from word -as word top
equiv_make gold top gate top word top
hierarchy -top equiv
equiv_simple
equiv_induct
equiv_status -assert
